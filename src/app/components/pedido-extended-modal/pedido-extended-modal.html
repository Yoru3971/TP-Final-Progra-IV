<h2 mat-dialog-title cdkFocusInitial>
  Pedido #{{ pedido.id }} — {{ pedido.emprendimiento.nombreEmprendimiento }}
</h2>

<mat-dialog-content>
  <div class="left-panel scrolleable">
    @for (detalle of pedido.viandas; track detalle.viandaId) {
    <div class="item-vianda">
      <div class="info">
        <p class="nombre">{{ detalle.nombreVianda }}</p>

        <p class="unitario">
          Precio unitario:
          <span class="precio">${{ detalle.precioUnitario }}</span>
        </p>

        <p class="cantidad">
          Cantidad: <strong>{{ detalle.cantidad }}</strong>
        </p>

        <p class="subtotal">
          Subtotal: <span class="precio">${{ detalle.subtotal }}</span>
        </p>
      </div>
    </div>
    }
  </div>

  <div class="right-panel">
    <!-- Detalle general -->
    <div class="detalle-general">
      <p>
        <span class="label">Fecha de entrega:</span>
        {{ pedido.fechaEntrega | date : 'dd/MM/yyyy' }}
      </p>

      <p>
        <span class="label">Total: </span> <span class="precio">${{ pedido.total }}</span>
      </p>

      <p>
        <span class="label">Estado: </span>
        <span class="estado" [class]="pedido.estado.toLowerCase()">{{ pedido.estado }}</span>
      </p>
    </div>

    <!-- Acciones -->
    <div class="acciones">
      <!-- CLIENTE — Pedido pendiente -->
      @if (role() === 'CLIENTE' && pedido.estado === 'PENDIENTE') {

      <!-- Selector de fecha -->
      <div class="grupo-fecha">
        <label>Nueva fecha</label>
        <input type="date" [(ngModel)]="nuevaFechaSeleccionada" class="input-date" />
      </div>

      <!-- Botón cambiar fecha -->
      <button class="btn btn-cambiar-fecha" (click)="cambiarFechaEntrega(nuevaFechaSeleccionada)">
        CAMBIAR FECHA
      </button>

      <!-- Botón cancelar pedido -->
      <button class="btn btn-rechazar" (click)="cambiarEstado(EstadoPedido.CANCELADO)">
        CANCELAR PEDIDO
      </button>
      }

      <!-- DUEÑO — Pedido pendiente -->
      @if (role() === 'DUENO' && pedido.estado === 'PENDIENTE') {
      <button class="btn btn-aceptar" (click)="cambiarEstado(EstadoPedido.ACEPTADO)">
        ACEPTAR PEDIDO
      </button>

      <button class="btn btn-rechazar" (click)="cambiarEstado(EstadoPedido.RECHAZADO)">
        RECHAZAR PEDIDO
      </button>
      }

      <!-- Botón contactar -->
      @if (role() === 'CLIENTE' || role() === 'DUENO') {
      <button class="btn">CONTACTAR</button>
      }

      <!-- Cerrar -->
      <button mat-dialog-close class="btn btn-cancelar">CERRAR</button>
    </div>
  </div>
</mat-dialog-content>
